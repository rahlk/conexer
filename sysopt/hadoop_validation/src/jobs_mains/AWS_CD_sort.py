'''
This tool runs a given configuration in string representation
and gets its the CPU time performance.
'''
import yaml
from profiler import Profiler

# best
best_str = "{'mapreduce.reduce.shuffle.merge.percent': '0.66', 'dfs.namenode.handler.count': '64', 'mapreduce.input.fileinputformat.split.minsize': '0', 'mapreduce.reduce.maxattempts': '4', 'mapred.map.output.compression.type': 'BLOCK', 'mapreduce.input.lineinputformat.linespermap': '1', 'yarn.resourcemanager.scheduler.client.thread-count': '64', 'mapreduce.task.merge.progress.records': '10000', 'mapreduce.map.output.compress.codec': 'org.apache.hadoop.io.compress.DefaultCodec', 'io.file.buffer.size': '65536', 'yarn.resourcemanager.store.class': 'org.apache.hadoop.yarn.server.resourcemanager.recovery.FileSystemRMStateStore', 'yarn.app.mapreduce.am.containerlauncher.threadpool-initial-size': '10', 'io.seqfile.sorter.recordlimit': '1000000', 'yarn.nodemanager.localizer.fetch.thread-count': '20', 'mapreduce.job.counters.max': '120', 'mapreduce.output.fileoutputformat.compress.codec': 'org.apache.hadoop.io.compress.DefaultCodec', 'mapreduce.job.speculative.speculative-cap-running-tasks': '0.1', 'yarn.resourcemanager.scheduler.class': 'org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler', 'mapreduce.ifile.readahead': 'true', 'yarn.sharedcache.enabled': 'false', 'mapreduce.tasktracker.taskmemorymanager.monitoringinterval': '5000', 'mapreduce.jobtracker.taskcache.levels': '2', 'mapreduce.ifile.readahead.bytes': '4194304', 'mapreduce.job.split.metainfo.maxsize': '10000000', 'yarn.nodemanager.container-manager.thread-count': '64', 'mapreduce.task.io.sort.mb': '200', 'mapreduce.job.speculative.retry-after-speculate': '15000', 'yarn.nodemanager.localizer.client.thread-count': '20', 'mapreduce.job.reduces': '1', 'mapreduce.map.java.opts': '-Xmx1229m', 'io.map.index.skip': '0', 'mapreduce.job.running.reduce.limit': '0', 'mapreduce.job.speculative.retry-after-no-speculate': '1000', 'mapreduce.job.reducer.unconditional-preempt.delay.sec': '300', 'yarn.nodemanager.recovery.compaction-interval-secs': '3600', 'mapreduce.job.speculative.speculative-cap-total-tasks': '0.01', 'mapreduce.reduce.merge.inmem.threshold': '1000', 'mapreduce.reduce.shuffle.retry-delay.max.ms': '60000', 'mapreduce.task.io.sort.factor': '48', 'mapreduce.jobtracker.expire.trackers.interval': '600000', 'mapreduce.tasktracker.map.tasks.maximum': '1', 'yarn.resourcemanager.resource-tracker.client.thread-count': '64', 'mapreduce.reduce.cpu.vcores': '1', 'mapreduce.reduce.shuffle.fetch.retry.timeout-ms': '30000', 'mapreduce.tasktracker.reduce.tasks.maximum': '1', 'yarn.nodemanager.windows-container.cpu-limit.enabled': 'false', 'mapreduce.shuffle.max.threads': '0', 'mapreduce.reduce.shuffle.parallelcopies': '20', 'mapreduce.reduce.shuffle.input.buffer.percent': '0.70', 'mapreduce.job.running.map.limit': '0', 'mapreduce.input.fileinputformat.split.maxsize': '268435456', 'mapreduce.reduce.shuffle.fetch.retry.interval-ms': '1000', 'yarn.sharedcache.admin.thread-count': '1', 'mapreduce.task.profile.reduces': '0-2', 'mapreduce.output.fileoutputformat.compress': 'false', 'mapreduce.shuffle.transfer.buffer.size': '131072', 'mapreduce.map.speculative': 'true', 'yarn.nodemanager.resource.memory-mb': '8192', 'yarn.app.mapreduce.am.job.task.listener.thread-count': '60', 'mapreduce.job.jvm.numtasks': '20', 'yarn.nodemanager.resource.cpu-vcores': '8', 'yarn.app.mapreduce.am.resource.mb': '3072', 'yarn.scheduler.maximum-allocation-mb': '6144', 'yarn.nodemanager.windows-container.memory-limit.enabled': 'false', 'mapreduce.tasktracker.indexcache.mb': '10', 'yarn.nodemanager.resource.percentage-physical-cpu-limit': '100', 'yarn.resourcemanager.client.thread-count': '64', 'mapreduce.reduce.java.opts': '-Xmx2560m', 'mapreduce.map.sort.spill.percent': '0.80', 'yarn.nodemanager.vmem-check-enabled': 'true', 'mapreduce.jobtracker.handler.count': '10', 'mapreduce.job.ubertask.maxreduces': '1', 'io.seqfile.compress.blocksize': '1000000', 'mapreduce.job.speculative.minimum-allowed-tasks': '10', 'yarn.app.mapreduce.am.command-opts': '-Xmx2458m', 'mapreduce.task.combine.progress.records': '10000', 'mapreduce.map.skip.maxrecords': '0', 'mapreduce.map.maxattempts': '4', 'mapreduce.tasktracker.http.threads': '60', 'yarn.app.mapreduce.am.resource.cpu-vcores': '1', 'io.map.index.interval': '128', 'mapreduce.task.profile.maps': '0-2', 'yarn.resourcemanager.amlauncher.thread-count': '50', 'mapreduce.job.max.split.locations': '10', 'mapreduce.reduce.input.buffer.percent': '0.0', 'mapreduce.reduce.shuffle.memory.limit.percent': '0.25', 'yarn.scheduler.minimum-allocation-vcores': '1', 'yarn.scheduler.minimum-allocation-mb': '32', 'mapreduce.jobtracker.maxtasks.perjob': '-1', 'mapreduce.job.ubertask.maxmaps': '9', 'mapreduce.job.ubertask.enable': 'false', 'mapreduce.shuffle.max.connections': '0', 'mapreduce.job.reduce.slowstart.completedmaps': '0.05', 'mapreduce.output.fileoutputformat.compress.type': 'BLOCK', 'dfs.replication': '1', 'mapreduce.map.skip.proc.count.autoincr': 'true', 'mapred.child.java.opts': '-Xmx200m', 'mapreduce.map.memory.mb': '1536', 'mapreduce.reduce.markreset.buffer.percent': '0.0', 'mapreduce.reduce.memory.mb': '3072', 'yarn.scheduler.increment-allocation-mb': '32', 'yarn.scheduler.maximum-allocation-vcores': '128', 'mapreduce.map.cpu.vcores': '1', 'ipc.maximum.data.length': '67108864', 'mapreduce.job.maps': '2', 'mapreduce.map.output.compress': 'true', 'yarn.sharedcache.client-server.thread-count': '50', 'yarn.resourcemanager.admin.client.thread-count': '1', 'io.compression.codecs': 'org.apache.hadoop.io.compress.DefaultCodec'}"

# default
def_str = "{'mapreduce.output.fileoutputformat.compress': 'true', 'mapreduce.shuffle.transfer.buffer.size': 192144, 'yarn.resourcemanager.scheduler.class': 'org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler', 'yarn.nodemanager.resource.memory-mb': '8192', 'mapreduce.reduce.shuffle.merge.percent': '0.66', 'yarn.app.mapreduce.am.job.task.listener.thread-count': '60', 'mapreduce.job.jvm.numtasks': 24, 'yarn.nodemanager.resource.cpu-vcores': '8', 'yarn.nodemanager.localizer.client.thread-count': '20', 'mapreduce.input.fileinputformat.split.minsize': '0', 'yarn.scheduler.maximum-allocation-mb': '6144', 'mapreduce.job.speculative.speculative-cap-total-tasks': '0.01', 'mapreduce.reduce.maxattempts': '4', 'mapreduce.tasktracker.indexcache.mb': '10', 'mapred.map.output.compression.type': 'BLOCK', 'mapreduce.input.lineinputformat.linespermap': '1', 'yarn.nodemanager.resource.percentage-physical-cpu-limit': '100', 'yarn.resourcemanager.scheduler.client.thread-count': '64', 'yarn.resourcemanager.client.thread-count': '64', 'mapreduce.task.merge.progress.records': '10000', 'mapreduce.reduce.java.opts': '-Xmx2560m', 'yarn.sharedcache.enabled': 'false', 'io.file.buffer.size': '65536', 'mapreduce.map.sort.spill.percent': '0.80', 'mapreduce.jobtracker.maxtasks.perjob': '-1', 'mapreduce.reduce.input.buffer.percent': 0.3, 'io.compression.codecs': 'org.apache.hadoop.io.compress.DefaultCodec', 'yarn.app.mapreduce.am.containerlauncher.threadpool-initial-size': '10', 'io.seqfile.sorter.recordlimit': '1000000', 'yarn.nodemanager.vmem-check-enabled': 'true', 'yarn.nodemanager.localizer.fetch.thread-count': '20', 'mapreduce.job.counters.max': 80, 'mapreduce.output.fileoutputformat.compress.codec': 'org.apache.hadoop.io.compress.DefaultCodec', 'mapreduce.jobtracker.handler.count': '10', 'mapreduce.job.speculative.speculative-cap-running-tasks': 0.08, 'mapreduce.map.speculative': 'true', 'mapreduce.job.ubertask.maxreduces': 6, 'mapreduce.ifile.readahead': 'true', 'mapreduce.map.output.compress.codec': 'org.apache.hadoop.io.compress.DefaultCodec', 'mapreduce.tasktracker.taskmemorymanager.monitoringinterval': 4000, 'io.seqfile.compress.blocksize': '1000000', 'mapreduce.jobtracker.taskcache.levels': '2', 'mapreduce.job.speculative.minimum-allowed-tasks': '10', 'yarn.app.mapreduce.am.command-opts': '-Xmx2750m', 'mapreduce.ifile.readahead.bytes': '4194304', 'mapreduce.job.split.metainfo.maxsize': 14000000, 'mapreduce.map.skip.maxrecords': '0', 'mapreduce.map.maxattempts': '4', 'mapreduce.tasktracker.http.threads': '60', 'yarn.app.mapreduce.am.resource.cpu-vcores': '1', 'yarn.nodemanager.container-manager.thread-count': '64', 'mapreduce.task.io.sort.mb': 160, 'io.map.index.interval': '128', 'mapreduce.job.speculative.retry-after-speculate': '15000', 'mapreduce.task.profile.maps': '2-4', 'yarn.resourcemanager.amlauncher.thread-count': '50', 'yarn.app.mapreduce.am.resource.mb': '3072', 'mapreduce.job.reduces': '1', 'mapreduce.job.max.split.locations': '10', 'yarn.resourcemanager.store.class': 'org.apache.hadoop.yarn.server.resourcemanager.recovery.FileSystemRMStateStore', 'mapreduce.reduce.shuffle.memory.limit.percent': '0.25', 'mapreduce.task.combine.progress.records': '10000', 'yarn.scheduler.minimum-allocation-vcores': '1', 'yarn.scheduler.minimum-allocation-mb': '32', 'yarn.resourcemanager.admin.client.thread-count': '1', 'mapreduce.map.java.opts': '-Xmx1229m', 'io.map.index.skip': '0', 'mapreduce.job.ubertask.enable': 'false', 'mapreduce.task.io.sort.factor': '48', 'mapreduce.job.speculative.retry-after-no-speculate': '1000', 'mapreduce.shuffle.max.connections': '0', 'mapreduce.job.reduce.slowstart.completedmaps': 0.08, 'mapreduce.job.reducer.unconditional-preempt.delay.sec': '300', 'yarn.nodemanager.recovery.compaction-interval-secs': '3600', 'mapreduce.output.fileoutputformat.compress.type': 'BLOCK', 'yarn.nodemanager.windows-container.memory-limit.enabled': 'false', 'mapreduce.reduce.merge.inmem.threshold': '1000', 'dfs.replication': '1', 'dfs.namenode.handler.count': '64', 'mapred.child.java.opts': '-Xmx200m', 'mapreduce.reduce.shuffle.retry-delay.max.ms': '60000', 'mapreduce.map.memory.mb': '1536', 'mapreduce.job.running.reduce.limit': 2, 'mapreduce.reduce.markreset.buffer.percent': '0.0', 'mapreduce.reduce.memory.mb': 2400, 'mapreduce.jobtracker.expire.trackers.interval': '600000', 'mapreduce.tasktracker.map.tasks.maximum': '1', 'yarn.scheduler.increment-allocation-mb': '32', 'yarn.resourcemanager.resource-tracker.client.thread-count': 52, 'yarn.scheduler.maximum-allocation-vcores': '128', 'mapreduce.map.skip.proc.count.autoincr': 'true', 'mapreduce.reduce.cpu.vcores': 5, 'mapreduce.map.cpu.vcores': '1', 'mapreduce.reduce.shuffle.fetch.retry.timeout-ms': '30000', 'mapreduce.tasktracker.reduce.tasks.maximum': '1', 'yarn.nodemanager.windows-container.cpu-limit.enabled': 'false', 'mapreduce.job.maps': 6, 'mapreduce.shuffle.max.threads': 6, 'mapreduce.map.output.compress': 'true', 'yarn.sharedcache.client-server.thread-count': '50', 'mapreduce.reduce.shuffle.parallelcopies': '20', 'mapreduce.reduce.shuffle.input.buffer.percent': '0.70', 'mapreduce.job.running.map.limit': 8, 'mapreduce.job.ubertask.maxmaps': '9', 'mapreduce.input.fileinputformat.split.maxsize': '268435456', 'mapreduce.reduce.shuffle.fetch.retry.interval-ms': '1000', 'ipc.maximum.data.length': 60000000, 'yarn.sharedcache.admin.thread-count': '1', 'mapreduce.task.profile.reduces': '0-2'}"

best_conf_dict = yaml.load(best_str)
def_conf_dict = yaml.load(def_str)

my_profiler = Profiler()

print 'best configuration:'
for i in range(2):
    res = my_profiler.profile(i, best_conf_dict)
    print res

print '======================'
print '======================'
print 'default configuration:'
for i in range(2):
    res = my_profiler.profile(i, def_conf_dict)
    print res

print 'Done!'
